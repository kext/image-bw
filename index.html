<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Black &amp; White</title>
  <style type="text/css">
    html {
      background: #333;
    }
    #container {
      position: fixed;
      top: 20px;
      right: 20px;
      bottom: 20px;
      left: 20px;
      text-align: center;
    }
    #canvas {
      max-width: 100%;
      max-height: 100%;
    }
  </style>
</head>
<body>
  <div id="container">
    <canvas id="canvas"></canvas>
  </div>
  <script type="text/javascript">
    var bw = function(data, offset, gamma) {
      var r = data[offset] / 255
      var g = data[offset + 1] / 255
      var b = data[offset + 2] / 255

      var c = Math.pow(0.299 * r + 0.587 * g + 0.114 * b, gamma)

      r = c * (1.0 - (1.0 - c) * 0.8)
      g = c * (1.0 - (1.0 - c) * 0.7)
      b = c * (1.0 - (1.0 - c) * 0.5)

      data[offset] = Math.round(r * 255.0)
      data[offset + 1] = Math.round(g * 255.0)
      data[offset + 2] = Math.round(b * 255.0)
    }
    var html = document.getElementsByTagName('html')[0]
    var canvas = document.getElementById('canvas')
    html.addEventListener('dragover', function(e) {
      e.preventDefault()
    })
    html.addEventListener('drop', function(e) {
      e.preventDefault()
      if (e.dataTransfer.files.length > 0) {
        var f = e.dataTransfer.files[0]
        var img = new Image()
        img.src = window.URL.createObjectURL(f)
        img.onload = function() {
          canvas.width = img.width
          canvas.height = img.height
          var ctx = canvas.getContext('2d')
          ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)
          ctx.drawImage(img, 0, 0)
          var data = ctx.getImageData(0, 0, img.width, img.height)
          for (var i = 0; i < img.width * img.height; ++i) {
            bw(data.data, i * 4, 0.7)
          }
          ctx.putImageData(data, 0, 0)
        }
      }
    })
  </script>
</body>
</html>
